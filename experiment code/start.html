<!--
  File: start.html
  Description: Buffers between consent form and the questionnaire; initializes jsPsych and JATOS, applies custom styling via external CSS.
  Component Input:
  {"welcome_screen1": "<br><b>Welcome to our study!</b><br><br>In our study, you will complete two rounds of a letter memory game, a reflection and writing challenge, and answer a few questionnaires.<br><img src='./assets/img/head_why.png' style='max-width:12%; height:auto;'><br><b>The study is relatively long (~50min)</b>. This includes plenty of breaks which we encourage you to take, because your full attention is crucial to us. We will therefore be checking your attention throughout the study, and <b>people who successfully pass all our attention checks will receive a bonus payment of Â£2.</b><br><br><b>Important reminders:</b><br> 1. Please avoid pressing the back button, as it will end your session. <br>2. Only reload the page if necessary, but be aware this may terminate your submission.<br> 3. If you fail the attention checks or switch tabs, your submission may be rejected according to Prolific's policy.<br>"}
  -->


<!DOCTYPE html>
<html>
  <head>
    <!-- Page Title -->
    <title>Welcome screen</title>

    <!-- External JS dependencies -->
    <script src="jatos.js"></script>
    <script src="./assets/append_data_to_jatos.js"></script>
    <script src="https://static.psyact.org/jspsych-7.3.1/jspsych.js"></script>
    <script src="https://static.psyact.org/jspsych-7.3.1/plugins/plugin-html-keyboard-response.js"></script>
    <script src="https://static.psyact.org/jspsych-7.3.1/plugins/plugin-html-button-response.js"></script>    

    <!-- External CSS -->
    <link href="https://static.psyact.org/jspsych-7.3.1/css/jspsych.css" rel="stylesheet" type="text/css" /> <!-- general jspsych styling -->
    <link href="css/styles.css" rel="stylesheet" type="text/css" /> <!-- costume page styling -->
    <style>
      body {
       background-color: #e0f7f3; /* background color for each section of the experiment is different for better orientation */
      }
    </style>
  </head>

  <body>
    <!-- Main body is empty; content generated by jsPsych timeline -->
  </body>
  
<script>
    // Initialize jsPsych and JATOS on load
    jatos.onLoad(() => {
      var jsPsych = initJsPsych({
        // on_trial_finish callback saves trial data
        on_trial_finish: function (data) {
          let trial_data_save = jsPsych.data.get().last(1).json();
          append_data_to_jatos(trial_data_save);
        },
        // on_finish callback moves to next component
        on_finish: () => jatos.startNextComponent()
      });

      // Add general properties to all trials
      jsPsych.data.addProperties({
        start_time: (new Date()).toISOString(),
        prolific_id: jatos.urlQueryParameters.PROLIFIC_PID,
        session_id: jatos.urlQueryParameters.SESSION_ID
      });
      
      // Build the timeline array
      var timeline = [];

      // Welcome screen trial configuration
      var welcome_screen1 = {
        type: jsPsychHtmlButtonResponse,
        stimulus: "<div class='compact-container'>" + jatos.componentJsonInput.welcome_screen1 + "</div>",
        choices: ['Continue'],
        post_trial_gap: 1000,
        on_finish: function(data){        
            // Capture participant environment data
            let w = window.innerWidth;
            let h = window.innerHeight;
            let userAgent = navigator.userAgent;
            let browserName = (function(){
              if (userAgent.indexOf("Firefox") > -1) return "Mozilla Firefox";
              if (userAgent.indexOf("Chrome") > -1) return "Google Chrome";
              if (userAgent.indexOf("Safari") > -1) return "Apple Safari";
              if (userAgent.indexOf("Opera") > -1) return "Opera";
              if (userAgent.indexOf("Edge") > -1) return "Microsoft Edge";
              if (userAgent.indexOf("Trident") > -1) return "Microsoft Internet Explorer";
              return "Unknown Browser";
            })();
            jsPsych.data.addProperties({
                ptp_browser: browserName,
                ptp_window_width: w,
                ptp_window_height: h
            });
            jatos.startNextComponent();
        }
      };
      timeline.push(welcome_screen1);

      // Run the experiment timeline
      jsPsych.run(timeline);
    });
  </script>
</html>
